<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Lamp setup by georgepaterson</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Lamp setup</h1>
        <p>Linux Apache MySQL PHP setup</p>

        <p class="view"><a href="https://github.com/georgepaterson/lamp-setup">View the Project on GitHub <small>georgepaterson/lamp-setup</small></a></p>


        <ul>
          <li><a href="https://github.com/georgepaterson/lamp-setup/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/georgepaterson/lamp-setup/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/georgepaterson/lamp-setup">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>Linux Apache MySQL PHP setup</h1>

<p>The LAMP stack is a very popular setup for a web server, it is relatively easy to create, leveraging open source software. Python or Perl may be used to replace PHP depending on specific requirements; additionally the AMP stack can be installed on alternative operating systems.</p>

<p>For this particular setup we will initially reference Red Hat Enterprise Linux / CentOS Linux version 5.x or above.</p>

<p>Your method of accessing the server will depend on it's location, either direct access or Secure Shell (SSH) for a remote server. If you have SSH access you should be able to skip sections 1 and 2. If you don't and the server is hosted remotely ask your support team to put your user on the sudoers list and give you SSH access.</p>

<h2>Section 1: Set up root access</h2>

<p>By default we don't want to login as root to perform tasks but we do want to give our user account root access when needed. To give our user root access we need to add them to the sudoers list.</p>

<p>Login as root:</p>

<pre><code>$ su
</code></pre>

<p>Then edit sudoers list, using visudo if available:</p>

<pre><code>$ visudo
</code></pre>

<p>Or edit the file with nano:</p>

<pre><code>$ nano /etc/sudoers
</code></pre>

<p>Under the section</p>

<pre><code>## Allow root to run any commands anywhere
root        ALL=(ALL)   ALL
</code></pre>

<p>Add</p>

<pre><code>username    ALL=(ALL)   ALL
</code></pre>

<p>Then if in visudo exit the file by entering <code>:wq</code> or use the standard exit path for your editor.</p>

<p>Finish using root and return to being your user:</p>

<pre><code>$ su username
</code></pre>

<p>You now have the ability to invoke root access by prepositioning any commands with the <code>sudo</code> key word.</p>

<p>Try using sudo by updating your server:</p>

<pre><code>$ sudo yum update
</code></pre>

<h2>Section 2: Secure Shell access</h2>

<p>Secure Shell allows an authenticated user a secure remote connect to the server shell where they can perform a range of tasks.</p>

<p>First we should confirm if SSH is already installed.</p>

<pre><code>$ sudo yum info sshd
</code></pre>

<p>If SSH is not installed then begin installation with:</p>

<pre><code>$ sudo yum install openssh-server
</code></pre>

<p>When installed start the service with:</p>

<pre><code>$ sudo service sshd start
</code></pre>

<p>You can now remotely access the server shell using:</p>

<pre><code>$ ssh username@server.ip.address
</code></pre>

<p>All further commands can be used directly or remotely on the server shell.</p>

<h2>Section 3: Installing Apache, MySQL and PHP</h2>

<p>Before installing Apache MySQL or PHP, you may want to check that they haven't already been installed.</p>

<pre><code>yum info httpd mysql php
</code></pre>

<p>This will return information on the specified installations.</p>

<p>If you don't have Apache MySQL or PHP plus extensions installed then this can be done with:</p>

<pre><code>yum install httpd mysql php php-gd php-mysql
</code></pre>

<p>With MySQL installed we need to create the MySQL root user:</p>

<pre><code>mysql -u root

mysql&gt; SET PASSWORD FOR 'root'@'localhost' = PASSWORD('new-password');
</code></pre>

<p>To load the MySQL PHP module we need to edit php.ini:</p>

<pre><code>sudo nano /etc/php.ini
</code></pre>

<p>In php.ini change:  </p>

<pre><code>;extension=mysql.so
</code></pre>

<p>to</p>

<pre><code>extension=mysql.so
</code></pre>

<p>Apache, MySQL and PHP should now be ready to use.   </p>

<h2>Section 4: Permissions for site deployment</h2>

<p>To deploy a web site to the server we will need to give our user permissions to write to the correct folders. The preferred method to do this is to create a group which the user can be attached to, the group can then be given the required folder permissions.</p>

<p>First check if the group already exists:</p>

<pre><code>cat /etc/group
</code></pre>

<p>To create a group called developers we can use:</p>

<pre><code>sudo groupadd developers
</code></pre>

<p>If groupadd is not available we can edit the group file using nano:</p>

<pre><code>sudo nano /etc/group
</code></pre>

<p>And create a new group at the end of the file:</p>

<pre><code>developers:x:groupid
</code></pre>

<p>To add the user to the group we can invoke usermod: </p>

<pre><code>usermod -G developers username
</code></pre>

<p>If usermod is unavailable </p>

<pre><code>sudo nano /etc/group
developers:x:groupid:username
</code></pre>

<p>With the group created and the user added to the group we can then change file and folder owners to the developers group.</p>

<p>To edit the Apache config:</p>

<pre><code>sudo chown -R :developers /etc/httpd/
</code></pre>

<p>To edit the hosts entry:</p>

<pre><code>sudo chown -R :developers /etc/hosts
</code></pre>

<p>To upload the site to the default Apache web folder:</p>

<pre><code>sudo chown -R :developers /var/www/
</code></pre>

<p>We will also want to give write permissions to the owners of the files and folders:</p>

<pre><code>sudo chmod -R g+w /etc/httpd/
sudo chmod -R g+w /etc/hosts
sudo chmod -R g+w /var/www/
</code></pre>

<h2>Section 5: Create a site domain</h2>

<p>We now want to create a site domain so that our deployed code can be viewed as a site on our server.</p>

<p>First we need to edit the host file so that domain names directed to the server are recognised:</p>

<pre><code>sudo nano /etc/hosts
</code></pre>

<p>At the end of the hosts entries add your domain name:</p>

<pre><code>127.0.0.1       your-site.tld
</code></pre>

<p>The .tld can be .com, net or if this is for internal development it can be of your choice like .local.</p>

<p>With the host entry now set we will want Apache to do something with the entry, we need to edit the virtual hosts setting for Apache:</p>

<pre><code>sudo nano /etc/httpd/conf/httpd.conf
</code></pre>

<p>Under Section 3: Virtual Hosts add a new virtual host:</p>

<pre><code>&lt;VirtualHost *:80&gt;
    ServerName your-site.tld
    DocumentRoot "/var/www/your-site"
    &lt;Directory "/var/www/html/your-site"&gt;
        Options Indexes FollowSymLinks +Includes ExecCGI
        AllowOverride All
        Order allow,deny
        Allow from all
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;
</code></pre>

<h3>Gzip</h3>

<p>When adding a new virtual host it is recommended that gzip compression is used. This can be as simple as adding AddOutputFilterByType, although mod_filter will give greater granularity.</p>

<pre><code>AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript
</code></pre>

<p>Support for older browsers may now be obsolete but if required the following properties can be added:</p>

<pre><code>BrowserMatch ^Mozilla/4 gzip-only-text/html
BrowserMatch ^Mozilla/4\.0[678] no-gzip
BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
</code></pre>

<p>Combined with the virtual hosts entry it should look like this:</p>

<pre><code>&lt;VirtualHost *:80&gt;
    ServerName your-site.com
    DocumentRoot "/var/www/your-site"
    &lt;Directory "/var/www/html/your-site"&gt;
        Options Indexes FollowSymLinks +Includes ExecCGI
        AllowOverride All
        Order allow,deny
        Allow from all
    &lt;/Directory&gt;
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript
&lt;/VirtualHost&gt;
</code></pre>

<h2>Section 6: Set up complete</h2>

<p>Set up should now be complete all that's left is to restart Apache so it picks up the updated setting.</p>

<pre><code>service httpd restart
</code></pre>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/georgepaterson">georgepaterson</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>